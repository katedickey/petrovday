<html>
  <head>
    <title>Petrov Day</title>
    <script type="text/javascript" src="/jquery-3.2.1.min.js"></script>
    <script>
      $(function() {

        function note_ews_reading(enemy, reading) {
          var p = $('<p/>');
          p.text(JSON.stringify(reading));
          $('#'+enemy+'-readings').append(p);
        }

        function read_ews_forever(enemy) {
          $.get('./read_ews/'+enemy, function(data) {
            note_ews_reading(enemy, JSON.parse(data));
            setTimeout(function(){read_ews_forever(enemy)}, 50);
          });
        }

        var enemies;
        $.get('enemies', function(data) {
          data = JSON.parse(data);
          enemies = data;
          console.log('enemies are:', enemies);
          for (var i=0; i<data.length; i++) {
            var div = $('<div/>');
            div.css({'border': '1px solid black',
                     'margin': '1em',
                     'display': 'inline-block'});
            div.attr({'id': data[i]+'-readings'});
            div.append($('<p><strong>'+data[i]+'</strong></p>'))
            $('#content').append(div);
            read_ews_forever(data[i]);
          }
        });

      });
    </script>
  </head>
  <body>
    <div id="content" style="layout: flex" />
  </body>
</html>
